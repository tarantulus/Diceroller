<!--Script references. -->
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    $(function () {
        // Declare a proxy to reference the hub. 
        var chat = $.connection.diceHub;
        // Create a function that the hub can call to broadcast messages.
        chat.client.broadcastMessage = function (name, message) {
            // Add the message to the page. 
            $('#log').append('<li><strong>' + name
                + '</strong>:&nbsp;&nbsp;' + message + '</li>');
        };

        chat.client.broadcastImg = function (img) {
            var imageObj = new Image();
            imageObj.src = img;
            imageObj.onload = function () {
                context.drawImage(this, 0, 0);
            };            
        };

        // Get the user name and store it to prepend to messages.
        $('#displayname').val("Ross");
        // Set initial focus to message input box.  
        $('#message').focus();
        // Start the connection.
        $.connection.hub.start().done(function () {
            chat.server.getLog();
            $('#sketchPad').mouseup(function () {
                var img = canvas.toDataURL("image/png");
                chat.server.sendCanvas(img);
            });
            $('#sendmessage').click(function () {
                // Call the Send method on the hub.
                if (!$('#diceroll').val()) {
                    roll = 0;
                    numdice = 0
                }
                else {
                    roll = $('#diceroll').val()
                    numdice = $('#numdice').val()
                }
                chat.server.send($('#displayname').val(), $('#message').val(), roll, numdice);
                // Clear text box and reset focus for next comment. 
                $('#message').val('').focus();
            });
        });
    });
</script>


<div class="container">
    <label for="message">Message</label>
    <input type="text" id="message" />
    <label for="diceroll">Dice to roll</label>
    <input type="text" id="diceroll" />
    <label for="numdice">How many times?</label>
    <input type="text" id="numdice" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="log">
    </ul>
    <script type="text/javascript" src=@Url.Content("~/Content/js/sketchPad.js")></script>

    <h2>Sketchpad</h2>
    <input type='text' id="colourPicker" value="#000" />
    <script type="text/javascript">
        $("#colourPicker").spectrum({
            change: onColorClick
        });
    </script>
    <div id="container">
        <canvas id="sketchPad" width="400" height="400">
            <p>Unsupported Browser</p>
        </canvas>
    </div>
</div>


